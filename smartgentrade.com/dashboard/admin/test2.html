<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SmartGen Admin — Dynamic Loader</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    :root{
      --bg:#f5f7fb; --card:#fff; --muted:#6b7280; --accent:#2563eb; --text:#0f172a;
    }
    [data-theme="dark"]{ --bg:#0b1220; --card:#0f1720; --muted:#9aa4b2; --accent:#f5b400; --text:#e6eef8; }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Poppins,system-ui,Arial;}
    .app{display:flex;height:100vh;gap:16px;padding:12px;box-sizing:border-box;}
    .sidebar{width:260px;background:var(--card);border-radius:12px;padding:16px;box-shadow:0 8px 24px rgba(2,6,23,0.08);display:flex;flex-direction:column;}
    .brand{font-weight:800;color:var(--accent);margin-bottom:6px;}
    .nav{flex:1;overflow:auto;margin-top:6px;}
    .nav a{display:block;padding:10px 12px;border-radius:8px;color:inherit;text-decoration:none;margin-bottom:6px;}
    .nav a.active{background:rgba(37,99,235,0.1);font-weight:700;}
    .sidebar .foot{margin-top:auto;display:flex;gap:8px;align-items:center;}
    .topbar{position:fixed;left:300px;right:12px;top:12px;height:56px;background:var(--card);border-radius:12px;padding:8px 14px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 8px 24px rgba(2,6,23,0.06);}
    .menu-btn{display:none}
    .main{flex:1;margin-left:0;padding:86px 18px 18px;overflow:auto;}
    @media(max-width:1000px){ .sidebar{position:fixed;left:-320px;top:0;bottom:0;z-index:999;transition:transform .2s ease} .sidebar.open{transform:translateX(320px);} .topbar{left:12px;right:12px;} .menu-btn{display:block} .main{padding-top:74px;} }
    .card{background:var(--card);padding:16px;border-radius:10px;box-shadow:0 8px 24px rgba(2,6,23,0.04);margin-bottom:12px;}
    .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    table{width:100%;border-collapse:collapse;font-size:14px}
    table thead th{background:rgba(0,0,0,0.03);padding:10px;text-align:left;color:var(--muted)}
    table tbody td{padding:10px;border-bottom:1px solid rgba(0,0,0,0.04)}
    .btn{padding:8px 10px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(0,0,0,0.06)}
    .small{padding:6px 8px;font-size:13px}
    .live-section{display:inline-block;margin-left:10px;color:var(--muted)}
  </style>
</head>
<body data-theme="dark">
  <div class="app">
    <aside class="sidebar card" id="sidebar">
      <div class="brand">SmartGen · Admin</div>
      <div class="muted">Control Center</div>
      <nav class="nav" id="mainNav">
        <a href="#" data-section="dashboard-overview" class="active">Dashboard Overview</a>
        <a href="#" data-section="active-users">Active Users</a>
        <a href="#" data-section="kyc-center">KYC Center</a>
        <a href="#" data-section="referrals">Referrals</a>
        <a href="#" data-section="deposits">Deposits</a>
        <a href="#" data-section="traders-list">Traders List</a>
        <a href="#" data-section="investment-plans">Investment Plans</a>
        <a href="#" data-section="create-trader">Create Trader</a>
        <a href="#" data-section="edit-trader">Edit Trader</a>
        <a href="#" data-section="all-trades">All Trades</a>
        <a href="#" data-section="edit-user">Edit User</a>
        <a href="#" data-section="withdrawal-requests">Withdrawal Requests</a>
      </nav>

      <div class="foot">
        <button id="themeToggle" class="btn small">Toggle theme</button>
        <button id="closeSidebar" class="btn ghost small">Close</button>
      </div>
    </aside>

    <div style="flex:1;display:flex;flex-direction:column;">
      <div class="topbar card">
        <div style="display:flex;align-items:center;gap:10px">
          <i id="mobileMenu" class="fas fa-bars menu-btn" style="font-size:18px;cursor:pointer"></i>
          <input id="globalSearch" placeholder="Search users, trades..." class="input" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
        </div>
        <div style="display:flex;gap:10px;align-items:center">
          <div class="muted">Admin</div>
          <div class="avatar" style="width:36px;height:36px;border-radius:8px;background:rgba(255,255,255,0.04)"></div>
        </div>
      </div>

      <main id="main" class="main">
        <!-- Sections (containers where each script expects DOM) -->
        <section id="dashboard-overview" class="section card">
          <div class="section-title">Dashboard Overview</div>
          <div class="grid3">
            <div class="card"><div class="muted">Registered Users</div><div id="registered" style="font-weight:800;font-size:20px">—</div></div>
            <div class="card"><div class="muted">Total Deposited</div><div id="totalDeposited" style="font-weight:800;font-size:20px">—</div></div>
            <div class="card"><div class="muted">Approved Deposits</div><div id="approvedDeposits" style="font-weight:800;font-size:20px">—</div></div>
            <div class="card"><div class="muted">Pending Deposits</div><div id="pendingDeposits" style="font-weight:800;font-size:20px">—</div></div>
            <div class="card"><div class="muted">Approved Withdrawals</div><div id="approvedWithdrawals" style="font-weight:800;font-size:20px">—</div></div>
            <div class="card"><div class="muted">Pending Withdrawals</div><div id="pendingWithdrawals" style="font-weight:800;font-size:20px">—</div></div>
          </div>
          <div class="card" style="margin-top:12px">Recent activity: <span id="recentActivity" class="muted">—</span></div>
        </section>

        <section id="active-users" class="section card" style="display:none">
          <div class="section-title">Active Users</div>
          <div class="table-wrapper card" style="padding:8px">
            <table><thead><tr><th>Name</th><th>Balance</th><th>Profit</th><th>View</th><th>Copy History</th><th>Delete</th></tr></thead><tbody class="table-body"></tbody></table>
          </div>
        </section>

        <section id="kyc-center" class="section card" style="display:none">
          <div class="section-title">KYC Center</div>
          <div id="imageElement" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px"></div>
          <div class="card" style="margin-top:12px">
            <table><thead><tr><th>From</th><th>Amount</th><th>Action</th></tr></thead><tbody class="table-body"></tbody></table>
          </div>
        </section>

        <section id="referrals" class="section card" style="display:none">
          <div class="section-title">Referrals</div>
          <div style="display:flex;justify-content:space-between;align-items:center" class="card">
            <div><div id="username" style="font-weight:700">—</div><div id="email" class="muted">—</div></div>
            <div>
              <div class="muted">Referral code</div>
              <input id="myInput" class="input" readonly style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
              <button id="copyReferral" class="btn ghost small">Copy</button>
            </div>
          </div>
          <div class="card" style="margin-top:12px"><table><thead><tr><th>Email</th></tr></thead><tbody class="table-body"></tbody></table></div>
        </section>

        <section id="deposits" class="section card" style="display:none">
          <div class="section-title">Deposits</div>
          <div class="card"><table><thead><tr><th>From</th><th>Amount</th><th>Method</th></tr></thead><tbody class="table-body"></tbody></table></div>
        </section>

        <section id="traders-list" class="section card" style="display:none">
          <div class="section-title">Traders List</div>
          <div class="card"><table><thead><tr><th>Name</th><th>ID</th><th>Create</th><th>Edit</th></tr></thead><tbody class="table-body"></tbody></table></div>
        </section>

        <section id="investment-plans" class="section card" style="display:none">
          <div class="section-title">Investment Plans</div>
          <div class="card"><table><thead><tr><th>From</th><th>Amount</th><th>Plan</th><th>Action</th></tr></thead><tbody class="table-body"></tbody></table></div>
        </section>

        <section id="create-trader" class="section card" style="display:none">
          <div class="section-title">Create Trader</div>
          <div class="card" style="display:flex;gap:12px">
            <div style="flex:1">
              <label class="muted">Name</label><input id="name" class="input" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
              <label class="muted">Level</label><input id="level" class="input" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
              <label class="muted">Rating</label><input id="rating" class="input" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
              <label class="muted">Commission</label><input id="commission" class="input" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
              <label class="muted">PNL</label><input id="pnl" class="input" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
            </div>
            <div style="flex:1">
              <label class="muted">Profile ID</label><input id="profileId" class="input" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
              <label class="muted">Account Level</label><input id="accountLevel" class="input" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
              <label class="muted">Type</label><input id="type" class="input" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
              <label class="muted">Followers</label><input id="followers" class="input" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
              <label class="muted">Watchers</label><input id="watchers" class="input" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
              <label class="muted">Profitable Trades</label><input id="profitableTrade" class="input" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
            </div>
          </div>
          <div class="card" style="margin-top:12px">
            <div class="muted">Upload Photo</div>
            <input id="image-upload" type="file" accept="image/*"/>
            <div id="image-preview" style="margin-top:8px;padding:12px;border-radius:8px;background:rgba(0,0,0,0.03);max-width:220px">
              <img id="uploaded-image" src="" style="width:100%;display:none;border-radius:8px"/>
            </div>
            <div style="margin-top:12px">
              <button id="registerBtn" class="btn">Create Trader</button>
              <div class="live-section" id="createTraderMessage"></div>
            </div>
          </div>
        </section>

        <section id="edit-trader" class="section card" style="display:none">
          <div class="section-title">Edit Trader</div>
          <div class="card">
            <div style="display:flex;gap:12px">
              <div style="flex:1">
                <label class="muted">Name</label><input id="name_edit" class="input"/>
                <label class="muted">Level</label><input id="level_edit" class="input"/>
                <label class="muted">Rating</label><input id="rating_edit" class="input"/>
                <label class="muted">Commission</label><input id="commission_edit" class="input"/>
              </div>
              <div style="flex:1">
                <label class="muted">PNL</label><input id="pnl_edit" class="input"/>
                <label class="muted">Profile ID</label><input id="profileId_edit" class="input"/>
                <label class="muted">Followers</label><input id="followers_edit" class="input"/>
                <label class="muted">Watchers</label><input id="watchers_edit" class="input"/>
              </div>
            </div>
            <div style="margin-top:12px">
              <button id="updateTraderBtn" class="btn">Update Trader</button>
              <div class="live-section" id="editTraderMessage"></div>
            </div>
          </div>
        </section>

        <section id="all-trades" class="section card" style="display:none">
          <div class="section-title">All Trades</div>
          <div class="card">
            <div class="table-wrapper" style="max-height:520px;overflow:auto">
              <table><thead><tr><th>Owner</th><th>Asset</th><th>Amount</th><th>Leverage</th><th>Duration</th><th>Countdown</th><th>P/L</th><th>Action</th><th>Status</th><th>Commands</th><th>Actions</th></tr></thead>
              <tbody id="tradeTable"></tbody></table>
            </div>
          </div>
        </section>

        <section id="edit-user" class="section card" style="display:none">
          <div class="section-title">Edit User Info</div>
          <div class="card" style="display:flex;gap:12px">
            <div style="flex:1">
              <label class="muted">First Name</label><input id="firstName" class="input"/>
              <label class="muted">Last Name</label><input id="lastName" class="input"/>
              <label class="muted">Email</label><input id="email" class="input"/>
              <label class="muted">Balance</label><input id="balance" class="input"/>
              <label class="muted">Profit</label><input id="profit" class="input"/>
            </div>
            <div style="flex:1">
              <label class="muted">Country</label><input id="country" class="input"/>
              <label class="muted">Copytrading</label><input id="copytrading" class="input"/>
              <label class="muted">KYC</label><input id="kyc" class="input"/>
              <label class="muted">Referral Bonus</label><input id="referalBonus" class="input"/>
              <label class="muted">_id</label><input id="_id" class="input" readonly/>
              <div style="margin-top:12px">
                <button id="enableBtn" class="btn small">Enable</button>
                <button id="disableBtn" class="btn small">Disable</button>
                <button id="updateBtn_user" class="btn">Save</button>
                <div class="live-section" id="editUserMessage"></div>
              </div>
            </div>
          </div>
        </section>

        <section id="withdrawal-requests" class="section card" style="display:none">
          <div class="section-title">Withdrawal Requests</div>
          <div class="card">
            <div class="table-wrapper"><table><thead><tr><th>From</th><th>Amount</th><th>Method</th><th>Address</th><th>Status</th><th>Approve</th><th>Decline</th></tr></thead><tbody class="table-body"></tbody></table></div>
          </div>
        </section>

      </main>
    </div>
  </div>

  <!--
    Below: original scripts you provided are placed inside <script type="text/plain">
    Each is untouched verbatim. The loader will inject them into the page when the section is first opened.
  -->

  <!-- Script source storage (verbatim originals) -->
  <script id="src-landing" type="text/plain">
<script>
    async function fetchUserInfo() {
      var parsedData = localStorage.getItem('user')
      var user = JSON.parse((parsedData))
      return user;
    }
    $(document).ready(async function () {
      const userInfo = await fetchUserInfo();
  
console.log(userInfo)
      $('#username').html(userInfo.firstName + " " + userInfo.lastName)
      $('#email').html(userInfo.email)
     
    });
  </script>
  <script>

 
    async function fetchUser() {
          const response = await $.ajax({
            type: "GET",
            url: 'https://smartgen-render.onrender.com/users',
            dataType: "json",
            timeout: 30000,
          });
    
          console.log(response.data);
          return response.data
        }
    
        function sendUserDetail(user){
          alert(user)
    
         localStorage.setItem("user",user)
         location.href="userinfo.html" 
    
    
    }
    
        
    $(document).ready(async function () {
  const users = await fetchUser();

  // Total registered users
  const registeredUsers = users.length;
  $('#registered').html(registeredUsers);

  // Initialize all counters
  let approvedDeposits = 0;
  let pendingDeposits = 0;
  let approvedWithdrawals = 0;
  let pendingWithdrawals = 0;

  let totalDeposited = 0;
  let withdrawnTotal = 0;
  let withdrawnAmount = 0;

  // Loop through all users
  users.forEach(user => {
    // Process transactions
    user.transactions.forEach(tx => {
      if (tx.status === "Approved") {
        approvedDeposits += 1;
        totalDeposited += Number(tx.amount || 0);
      } else if (tx.status === "pending") {
        pendingDeposits += 1;
      }
    });

    // Process withdrawals
    user.withdrawals.forEach(wd => {
      if (wd.status === "Approved") {
        approvedWithdrawals += 1;
        withdrawnTotal += Number(wd.amount || 0);
      } else if (wd.status === "pending") {
        pendingWithdrawals += 1;
      }
    });
  });

  // Update HTML
  $('#totalDeposited').html("$" + totalDeposited);
  $('#approvedDeposits').html(approvedDeposits);
  $('#pendingDeposits').html(pendingDeposits);
  $('#approvedWithdrawals').html(approvedWithdrawals);
  $('#pendingWithdrawals').html(pendingWithdrawals);
});

    
      </script>
  </script>

  <script id="src-activeusers" type="text/plain">
<script>

 
  async function fetchUser() {
        const response = await $.ajax({
          type: "GET",
          url: 'https://smartgen-render.onrender.com/users',
          dataType: "json",
          timeout: 30000,
        });
  
        console.log(response.data);
        return response.data
      }
  
      function sendUserDetail(userem){
        
  
       localStorage.setItem("userem",userem)
       location.href="userinfo.html" 
  
  
  }
  function pushUserDetail(userem){
        
  
        localStorage.setItem("userem",userem)
        location.href="copyhistory.html" 
   
   
   }
  
  
  async function deleteUser(userem){
     var userconfirmed=  confirm("ARE YOU SURE YOU WANT TO DELETE THIS USER" +" "+ userem)
     if (userconfirmed) {
   
  
      const response = await $.ajax({
      type: "DELETE",
      url: `https://smartgen-render.onrender.com/users/${userem}/delete`,
      dataType: "json",
      timeout: 30000,
      success: function () {
          $('.live-section').addClass("alert-danger").text("User deleted successfully");
          alert("User Deleted");
          setTimeout(function () {
              $(location).prop('href', './activeusers.html');
          }, 2000); // Redirect after 2 seconds
      },
      error: function (xhr, status, error) {
          alert("Failed to delete user: " + error);
          console.error("Error details:", status, error);
      }
  });
  
    
  }
  else{
  
    alert("kept")}
  
        // localStorage.setItem("userem",userem)
        // location.href="userinfo.html" 
   
   
   }
      
      $(document).ready(async function () {
        const users = await fetchUser();
         
  
        var tbl = $('.table-body');
  var td=$('<td>');
       users.forEach(function (user) {
       
          var row = $('<tr>').appendTo(tbl);
          $('<td>').text(`${user.firstName}`).appendTo(row);
          $('<td>').text(`$${user.balance}`).appendTo(row);
            $('<td>').text(`$${user.profit}`).appendTo(row);
         
          $('<td><a  class="btn-primary btn-lg pl-10 w-20 mr-3 m-5" onclick="sendUserDetail(\''+user.email+'\')"  > <i class=" fas fa-eye"></i></a> </td>').appendTo (row);
          tbl.appendTo($(".table"));
          $('<td><a  class="btn-primary btn-lg pl-10 w-20 mr-3 m-5" onclick="pushUserDetail(\''+user.email+'\')"  > <i class=" fas fa-plus"></i></a> </td>').appendTo (row);
          tbl.appendTo($(".table"));
          $('<td><a  class="btn-danger btn-lg pl-10 w-20 mr-3 m-5" onclick="deleteUser(\''+user.email+'\')"  > <i class=" fas fa-trash"></i></a> </td>').appendTo (row);
          tbl.appendTo($(".table"));
          
  

        })
  
        
       
      
      });
  
      
  
      
  
     
  
     
  
  
    </script>
  </script>

  <script id="src-kyc" type="text/plain">
<script>
  function displayImages(images) {
     const galleryDiv = document.getElementById('imageGallery');
 console.log(images);
     images.forEach(image => {
      let imageContainer = $('<div class="image-container"></div>');

// Create and append the docNum

// Create and append the imgUrl
let imgElement = $('<img>').attr('src', image.imageUrl).attr('alt', `Image of ${image.docNum}`).addClass('galleryImage');
imageContainer.append(imgElement);

// Create and append the owner
let ownerElement = $('<h3></h3>').text(`Owner: ${image.owner}`);
imageContainer.append(ownerElement);
let docNumElement = $('<p></p>').text(`Document Number: ${image.docNum}`);
imageContainer.append(docNumElement);


// Append the image container to the main imgElement div
$('#imageElement').append(imageContainer);
     });
   }
   async function fetchImages() {
     try {
       const response = await fetch('https://smartgen-render.onrender.com/auth/kyc/fetch-images');
       if (response.ok) {
         const images = await response.json();
        
         displayImages(images);
       } else {
         console.error('Error fetching images:', response.status);
       }
     } catch (error) {
       console.error('Error fetching images:', error);
     }
   }
 
   // Fetch images when the page loads
   $(document).ready(async function () {
   fetchImages();
   })

  
 </script>

<script type="text/javascript">
    async function fetchUser() {
      const response = await $.ajax({
        type: "GET",
        url: ' https://smartgen-render.onrender.com/users',
        dataType: "json",
        timeout: 30000,
      });

      console.log(response.data);
      return response.data
    }

    function sendUserDetail(userem){
    

     localStorage.setItem("userem",userem)
     location.href="userinfo.html" 


}

    
    $(document).ready(async function () {
        
      
       const users = await fetchUser();
    
       
  
      var tbl = $('.table-body');
var td=$('<td>');
     users.forEach(function (user) {
        const trans=user.transactions;
        trans.forEach(function(transac){
            var row = $('<tr>').appendTo(tbl);
        $('<td>').text(`${transac.from}`).appendTo(row);
            $('<td>').text(`$${transac.amount}`).appendTo(row);
              $('<td><a  class="btn-primary btn-lg pl-10 w-20 mr-3 m-5" onclick="sendUserDetail(\''+user.email+'\')"  >User Info</a></td>').appendTo (row);
              
                tbl.appendTo($(".table"));

        })
        
      })
    
    });
    </script>
  </script>

  <script id="src-referrals" type="text/plain">
<script>
    function trade(){
    
      $('#stat').html("Ongoing Trade")
      $('#stat2').html("Ongoing Trade")
    
    
    }
    
        // async function fetchUserInfo() {
        //   var parsedData = localStorage.getItem('user')
        //           var user = JSON.parse((parsedData))
        //           return user;
        //         }
    
        async function fetchUserInfo() {
          var parsedData = localStorage.getItem('user')
          var userFromLS = JSON.parse((parsedData))
    
          console.log(userFromLS);
    
          const response = await $.ajax({
            type: "GET",
            url: `https://smartgen-render.onrender.com/users/${userFromLS.email}`,
            dataType: "json",
            timeout: 30000,
            success: async function (data) {
              Object.assign(currentUser, data.data)
              await localStorage.setItem("user", JSON.stringify(data.data))
            },
            error: function () {
              alert(error)
            }
          });
    
          return response.data;
        }
    
        $(document).ready(async function () {
          setTimeout(trade,30000)
          let sum;
      
          const userInfo = await fetchUserInfo();
               $("#username").html(userInfo.firstName + " " + userInfo.lastName);
               $("#email").html(userInfo.email);
               $("#accountBalance").html('$'+ userInfo.balance);
               $("#profit").html('$'+ userInfo.profit);
               $("#myInput").val(userInfo.referralCode);
              
            
               var tbl = $('.table-body');
    
   userInfo.referredUsers.forEach(function (user) {
      console.log(user)
        var row = $('<tr></tr>').appendTo(tbl);
        $('<td></td>').text(`${user}`).appendTo(row);
        
        tbl.appendTo($(".table"));
   
    
        });
    
      });
        
    
      </script>
  </script>

  <script id="src-deposits" type="text/plain">
<script>
    async function fetchUserTx(id) {
      const response = await $.ajax({
        type: "GET",
        url: `https://smartgen-render.onrender.com/users/transactions/${id}/deposit/history`,
        dataType: "json",
        timeout: 30000,
      });

      console.log(response.data);
      return response.data
    }

    async function fetchUserFromLocalStorage() {
      var parsedData = localStorage.getItem('user')
      var user = JSON.parse((parsedData))
      return user;
    }


    $(document).ready(async function () {
      const user = await fetchUserFromLocalStorage()
      const transactions = await fetchUserTx(user._id);

      var tbl = $('.table-body');

      transactions.forEach(function (transaction) {
        var row = $('<tr>').appendTo(tbl);
        $('<td>').text(`${transaction.from}`).appendTo(row);
        $('<td>').text(`$${transaction.amount}`).appendTo(row);
        // $('<td>').text("Pending").appendTo(row);
        $('<td>').text(`${transaction.method}`).appendTo(row);
        tbl.appendTo($(".table"));
      });



    });
  </script>
  </script>

  <script id="src-traderslist" type="text/plain">
<script>
    function killLoader(){
      var loader=document.getElementById('loader')
      loader.style="display:none"
    
    }
     
            function sendUserDetail(userem){
              
        
             localStorage.setItem("userem",userem)
             location.href="add.html" 
        
        
        }
    
        function viewUserDetail(userem){
              
        
              localStorage.setItem("userem",userem)
              location.href="traderinfo.html" 
         
         }
         async function fetchUser() {
  try {
    const response = await fetch('https://smartgen-render.onrender.com/auth/trader/fetch-trader');
    
    if (response.ok) {
      const traders = await response.json(); // Parse the JSON response
      console.log(traders); // Log the traders for debugging
      return traders; // Return the parsed data
    } else {
      console.error('Error fetching traders:', response.status); // Handle unsuccessful response
    }
  } catch (error) {
    console.error('Error fetching traders:', error); // Handle any errors during the fetch
  }
}

 
            $(document).ready(async function () {
            

              const users = await fetchUser();
    
               const reversed=users.reverse()
        console.log(users);
              var tbl = $('.table-body');
        var td=$('<td>');
             reversed.forEach(function (user) {
             
                var row = $('<tr>').appendTo(tbl);
                $('<td>').text(`${user.name}`).appendTo(row);
                    $('<td>').text(`${user._id}`).appendTo(row);
              
                $('<td><a style="display:inline-block;white-space: nowrap;"  class="btn-primary btn-lg pl-1 w-20 mr-3" onclick="sendUserDetail(\''+user._id+'\')"  >Create signal</a> </td>').appendTo (row);
                $('<td><a style="display:inline-block;white-space: nowrap;" class="btn-success btn-lg pl-1 w-20 mr-3 " onclick="viewUserDetail(\''+user._id+'\')"  >Edit Profile</a> </td>').appendTo (row);
               
                tbl.appendTo($(".table"));
        
              })
        
            });
  </script>
  </script>

  <script id="src-plans" type="text/plain">
<script type="text/javascript">
    async function fetchUser() {
      const response = await $.ajax({
        type: "GET",
        url: ' https://smartgen-render.onrender.com/users',
        dataType: "json",
        timeout: 30000,
      });

      console.log(response.data);
      return response.data
    }

    function sendUserDetail(userem){
    

     localStorage.setItem("userem",userem)
     location.href="userinfo.html" 


}

    
    $(document).ready(async function () {
        
      
       const users = await fetchUser();
    
       
  
      var tbl = $('.table-body');
var td=$('<td>');
     users.forEach(function (user) {
        const trans=user.plan;
        trans.forEach(function(transac){
          const details=[user._id,transac._id]
       
            var row = $('<tr>').appendTo(tbl);
        $('<td>').text(`${transac.from}`).appendTo(row);
            $('<td>').text(`$${transac.subamount}`).appendTo(row);
              $('<td>').text(`${transac.subname}`).appendTo(row);
            
                $('<td><a  class="btn-primary btn-lg pl-10 w-20 mr-3 m-5" onclick="sendUserDetail(\''+user.email+'\')"  >User Info</a></td>').appendTo (row);
             
                tbl.appendTo($(".table"));

        })
      })  
    });

    async function sendTransacDetail(details){
 _id=details[0]+details[1]+details[2]+details[3]+details[4]+details[5]+details[6]+details[7]+details[8]+details[9]+details[10]+details[11]+details[12]+details[13]+details[14]+details[15]+details[16]+details[17]+details[18]+details[19]+details[20]+details[21]+details[22]+details[23];


 transactionId=details[25]+details[26]+details[27]+details[28]+details[29]+details[30]+details[31]+details[32]+details[33]+details[34]+details[35]+details[36]+details[37]+details[38]+details[39]+details[40]+details[41]+details[42]+details[43]+details[44]+details[45]+details[46]+details[47]+details[48]+details[49]+details[50]+details[51]+details[52]+details[53]+details[54]+details[55]+details[56]+details[57]+details[58]+details[59]+details[60];

var send=[transactionId,_id]

 const response = await $.ajax({
type: "PUT",
url: ` https://smartgen-render.onrender.com/transactions/${_id}/transactions/${transactionId}/confirm`,
dataType: "json",
data:{_id,transactionId},
timeout: 30000,

success: function () {
  $('.live-section').addClass("alert-primary").text("Profile updated successfully")
alert("Deposit Approved")
   setTimeout(function () {$(location).prop('href', './depositshistory.html')     
              }, 1000 * 2)

}
});

console.log(response);
return response.data
}

async function declineUserDetail(details){
  
  _id=details[0]+details[1]+details[2]+details[3]+details[4]+details[5]+details[6]+details[7]+details[8]+details[9]+details[10]+details[11]+details[12]+details[13]+details[14]+details[15]+details[16]+details[17]+details[18]+details[19]+details[20]+details[21]+details[22]+details[23];


 transactionId=details[25]+details[26]+details[27]+details[28]+details[29]+details[30]+details[31]+details[32]+details[33]+details[34]+details[35]+details[36]+details[37]+details[38]+details[39]+details[40]+details[41]+details[42]+details[43]+details[44]+details[45]+details[46]+details[47]+details[48]+details[49]+details[50]+details[51]+details[52]+details[53]+details[54]+details[55]+details[56]+details[57]+details[58]+details[59]+details[60];

var declineBtn=document.getElementById("decline")
decline.innerHTML="Processing"
    
const response = await $.ajax({
type: "PUT",
url: ` https://smartgen-render.onrender.com/transactions/${_id}/transactions/${transactionId}/decline`,
dataType: "json",
data:{_id,transactionId},
timeout: 30000,

success: function () {
  $('.live-section').addClass("alert-primary").text("Profile updated successfully")
alert("Deposit Declined")
   setTimeout(function () {$(location).prop('href', './depositshistory.html')     
              }, 1000 * 2)

}
});

console.log(response);
return response.data

}
  </script>
  </script>

  <script id="src-create-trader" type="text/plain">
<script>
    var btn=document.getElementById('registerBtn');
function red () {
     btn.style.opacity="1"
     btn.innerHTML="Create Trader"
   }

function blurr (){
 
 btn.style.opacity="0.5"
 btn.innerHTML= "Loading . . ."

}
function topFunction() {
  document.body.scrollTop = 0; // For Safari
  document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
}

const cloudName = 'dsyjlantq';
      const uploadPreset = 'assetspur'; 
      
      // function storeImg(imageUrl) {
      //     console.log(imageUrl);
      //     $.ajax({
      //         type: 'POST',
      //         url: 'https://smartgen-render.onrender.com/auth/kyc',
      //         dataType: 'json',
      //         data: { imageUrl },
      //         timeout: 30000,
      //         success: function (data) {
      //             console.log(data);
      //             $('.live-section').html('Picture was successfully uploaded').addClass('');
      //             setTimeout(function () {
      //                 // $(location).prop('href', './dashboard.html');
      //             }, 7000);
      //         },
      //         error: function (xhr, status, error) {
      //             console.log(error);
      //             $('.live-section').html('Error uploading image').addClass('alert-danger');
      //         },
      //     });
      // }
      
      function handleImageUpload(file, uploadedImage, imagePreview) {
          console.log(file);
          const formData = new FormData();
          formData.append('file', file);
          formData.append('upload_preset', uploadPreset);
      
          fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
              method: 'POST',
              body: formData,
          })
          .then(response => response.json())
          .then(data => {
              const imageUrl = data.secure_url;
              localStorage.setItem("imgUrl",imageUrl)
              uploadedImage.src = imageUrl;
              uploadedImage.style.display = 'block';
              imagePreview.style.border = 'none';
              console.log(imageUrl);
              // storeImg(imageUrl);
          })
          .catch(error => {
              console.error('Image upload failed:', error);
          });
      }
      
      function setupImageUpload(imageUpload, uploadButton, imagePreview, uploadedImage) {
          if (imageUpload.files && imageUpload.files[0]) {
              var file = imageUpload.files[0];
              handleImageUpload(file, uploadedImage, imagePreview);
          }
      }
      const imageUpload = document.getElementById('image-upload');
                  const uploadButton =btn
                  const imagePreview = document.getElementById('image-preview');
                  const uploadedImage = document.getElementById('uploaded-image');
                
              



     // === Trader Registration === //
async function registerTrader(values) {
  try {
    const response = await $.ajax({
      type: "POST",
      url: "https://smartgen-render.onrender.com/auth/trader/register",
      dataType: "json",
      data: { ...values },
      timeout: 30000,
    });

    console.log("✅ Trader Created:", response);
    $(".live-section")
      .html("Trader was successfully created")
      .removeClass("alert-danger")
      .addClass("alert-success");

    // SweetAlert success popup (optional)
    // swal("Success", "Trader created successfully!", "success");

    // Redirect after success
    setTimeout(() => {
      window.location.href = "./list.html";
    }, 1500);
  } catch (error) {
    console.error("❌ Registration error:", error);
    $(".live-section")
      .html("Network connection error. Try again")
      .removeClass("alert-success")
      .addClass("alert-danger");
  }
}

// === Handle Button Click === //
$("#registerBtn").click(async function (e) {
  e.preventDefault();

  // Setup image upload
  setupImageUpload(imageUpload, uploadButton, imagePreview, uploadedImage);

  // Wait briefly for upload to finish
  setTimeout(async function () {
  // Collect form values according to the new schema
const traderData = {
  name: $("#name").val(),
  level: $("#level").val(),
  rating: $("#rating").val(),
  // trades: $("#trades").val(),
  commission: $("#commission").val(),
  pnl: $("#pnl").val(),
  profileId: $("#profileId").val(),
  accountLevel: $("#accountLevel").val(),
  type: $("#type").val(),
 
  followers: $("#followers").val(),
  watchers: $("#watchers").val(),
  profitableTrade: $("#profitableTrade").val(),
  photo: localStorage.getItem("imgUrl") // optional, keeps the uploaded image
};


